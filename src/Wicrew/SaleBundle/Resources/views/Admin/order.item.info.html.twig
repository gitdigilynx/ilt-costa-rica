{# @var item \App\Wicrew\SaleBundle\Entity\OrderItem #}
<div class="product-detail" style="display: flex;margin-top: 20px;">  
    <div class="left-panel" style="border:1px solid;border-radius: 4px;padding: 20px;margin-right: 5px;">
        {% if email is not defined or email == false %}
            <div class="edit-item">
                <a href="{{ path('order_item_edit', { id: item.id }) }}" style="font-weight:bold;text-decoration:underline">Edit</a>
                <a href="{{ path('order_item_delete', { id: item.id }) }}"
                    onclick="confirm('{{ "delete.confirm"|trans() }}')" class="text-danger" style="font-weight:bold;text-decoration:underline">Delete</a>
            </div>
        {% endif %}


        <div class="product-details-subcontainer">
            {% if item.status is constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::STATUS_PAID') %}
                <div style="color: #22C55E; font-weight: bold; margin-bottom: 10px;" >Paid</div>
            {% endif %}
            
            {% if item.status is constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::STATUS_UNPAID') %}
                <div style="color: #F97316; font-weight: bold; margin-bottom: 10px;" >Un-paid</div>
            {% endif %}
            
            {% if item.status is constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::STATUS_CANCELLED') %}
                <div style="color: red; font-weight: bold; margin-bottom: 10px;" >Cancelled</div>
            {% endif %}
            <div>
                Service Type:  
                <span style="text-transform:uppercase">
                {% if item.product is not null %}
                    {{ item.product.transportationType.name }}
                {% elseif item.type == constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::TYPE_ACTIVITY_REGULAR') %}
                    {{ item.activity.name }}
                {% elseif item.type == constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::TYPE_ACTIVITY_TRANSPORTATION') %}
                    {{ item.activity.name ~ 'order.items.activity.transportation'|trans }}
                {% endif %}
                </span> 
            </div>
            <br />

            <div>
                Reservation ID: <span style="color:red"><strong>#RJ{{item.order.id}}</strong></span>
            </div>
            <div style="font-weight: bold;">
                Client Name: <span style="text-transform: capitalize; font-weight: bold;"> {{item.order.firstName ~ ' ' ~ item.order.lastName }} </span>
            </div>
            <div style="font-weight: bold;">
                Pickup Date: <span >{{ item.pickDate|date("F jS, Y") }}</span>
            </div>
            

            {% if item.pickArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AIRPORT')) %}           
                <div>
                    From:  <span >{{ item.pickArea.name }}</span>
                </div>      
            {% else %}
                {% if item.pickAddress %}
                    <div>
                        From:  <span >{{ item.pickAddress }}</span>
                    </div>
                {% else %}
                    <div>
                        From:  <span >{{ item.pickArea.name }}</span>
                    </div>      
                {% endif %}
            {% endif %}

            {% if item.dropArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AIRPORT')) %}           
                <div>
                    Drop-off:  <span >{{ item.dropArea.name }}</span>
                </div>      
            {% else %}
                {% if item.dropAddress %}
                    <div>
                        Drop-off:  <span >{{ item.dropAddress }}</span>
                    </div>

                {% else %}
                    <div>
                        Drop-off:  <span >{{ item.dropArea.name }}</span>
                    </div>   
                {% endif %}
            {% endif %}


            {% if item.pickArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AREA')) and item.dropArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AIRPORT')) %}           
                
                {% if item.pickTimeTransport %}
                    <div>
                        <span style="background: yellow; font-weight: bold;">Pickup  time: {{item.pickTimeTransport|formatNoNull("H:i")}}</span> 
                    </div>
                {% else %}
                    <div style="font-weight: bold;">
                        Pickup time:  <span style="color: red;"> <strong>To be confirmed upon confirmation</strong> </span>  
                    </div>
                {% endif %}

                {% if item.pickTime %}
                    <div>
                        Departure Time: <span>{{item.pickTime|formatNoNull("H:i")}}</span>
                    </div>
                {% endif %}
            {% elseif item.pickArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AIRPORT')) and item.dropArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AREA'))  %}
                {% if item.pickTime %}
                    <div>
                        <span style="background: yellow; font-weight: bold;">
                            Arrival Time: <span>{{item.pickTime|formatNoNull("H:i")}}</span>
                        </span>
                    </div>
                {% endif %}
            {% elseif item.pickArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AIRPORT')) and item.dropArea.type is same as(constant('\\App\\Wicrew\\ProductBundle\\Entity\\Area::TYPE_AIRPORT'))  %}
                {% if item.pickTime %}
                    <div>
                        <span style="background: yellow; font-weight: bold;">
                            Arrival Time: <span>{{item.pickTime|formatNoNull("H:i")}}</span>
                        </span>
                    </div>
                {% endif %}
            {% else %}
                {% if item.pickTime %}
                    <div>

                        <span style="background: yellow; font-weight: bold;">
                            Pickup Time: <span>{{item.pickTime|formatNoNull("H:i")}}</span> 
                        </span>
                    </div>
                {% else %}
                    <div style="font-weight: bold;">

                        Pickup time:  <span style="color: red;"> <strong>To be confirmed upon confirmation</strong> </span>  
                    </div>
                {% endif %}
            {% endif %} 

            {% if (item.pickAirlineCompany) or (item.dropAirlineCompany) %}
                <div>
                    Airline: <span>{% if item.pickFlightNumber %}{{item.pickAirlineCompany}}{% else %}{{item.dropAirlineCompany}}{% endif %}</span> 
                </div>
            {% endif %}

            {% if (item.pickFlightNumber) or (item.dropFlightNumber) %}
                <div>
                    Flight #: <span>{% if item.pickFlightNumber %}{{item.pickFlightNumber}}{% else %}{{item.dropFlightNumber}}{% endif %}</span> 
                </div>
            {% endif %}


            {% if item.activity is not null %}
                <div>
                    Service Time:  <span>{{ item.tourTime|formatNoNull("H:i") }}</span> 
                </div> 
            {% endif %} 
            {% if item.product is not null %} 
                <div>
                    Vehicle:  <span >{{ item.product.vehicleType.name }}</span> 
                </div>
            {% endif %} 
            <div>
                    Adults:  <span>{{ item.adultCount }}</span> 
            </div>
            {% if item.childCount > 0 %}
                <div>
                        Children:  <span>{{ item.childCount }}</span> 
                </div> 
            {% endif %}

            {% if item.childrenAges is not null %} 
                <div>
                    Children Ages:  <span>{{ item.childrenAges }}</span>
                </div>
            {% endif %}

            {% if item.product is not null %}
                <div>
                    Travel time:  
                    <span >
                    {% set hour = item.product.duration|round(0, 'floor')  %}
                    {% set min = (60 * (item.product.duration - hour))|round  %}
                    {% if hour <= 0 %}
                        {{ min ~ ' Minutes ' }}
                    {% elseif hour == 1 %}
                        {% if min <= 0 %}
                            {{ hour ~ ' Hour ' }}
                        {% elseif min >= 1 %}
                            {{ hour ~ ' Hour ' ~ min ~ ' Minutes ' }}
                        {% endif %}
                    {% elseif hour > 1 %}
                        {% if min <= 0 %}
                            {{ hour ~ ' Hours ' }}
                        {% elseif min >= 1 %}
                            {{ hour ~ ' Hours ' ~ min ~ ' Minutes ' }}
                        {% endif %}
                    {% endif %}
                    </span>
                </div> 
            {% endif %} 
            {% if item.type == constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::TYPE_PRIVATE_FLIGHT') %}
                <div> 
                    <div>
                            {{ 'booking.luggage.weight'|trans }}:   {{ item.luggageWeight }}
                    </div>
                    <div>
                            {{ 'booking.passenger.weight'|trans }}:   {{ item.passengerWeight }}
                    </div>
                </div>
            {% endif %}

            {% if item.anyTimeRangeFees %}
                <br>
                <div>
                    <div><label>{{ 'order.items.range_fees'|trans() }}</label></div>
                    {% if item.regularTimeFeeRack is not null %}
                        <div class="inside">
                            <label>{{ 'product.section.regular_time_range'|trans }}</label> {{ 'currency.symbol'|trans() ~ item.regularTimeFeeRack }}
                        </div>
                    {% endif %}
                    {% if item.flightPickTimeFeeRack is not null %}
                        <div class="inside">
                            <label>{{ 'product.section.flight_pickup_time_range'|trans }}</label> {{ 'currency.symbol'|trans() ~ item.flightPickTimeFeeRack }}
                        </div>
                    {% endif %}
                    {% if item.flightDropTimeFeeRack is not null %}
                        <div class="inside">
                            <label>{{ 'product.section.flight_drop_off_time_range'|trans }}</label> {{ 'currency.symbol'|trans() ~ item.flightDropTimeFeeRack }}
                        </div>
                    {% endif %}
                </div> 
            {% endif %} 
            {% if item.customerNotes %}
                <div>
                    <br />
                    <strong style="font-weight:bold;text-decoration: underline;">Notes:</strong><br>
                    {{ item.customerNotes|raw }}
                </div>
            {% endif %}
            
            {% if item.anyAddons or item.anyExtras%}
                <br />
                <div>
                    <strong style="text-decoration:underline">Add-on services:  </strong>
                </div>
                {% if item.anyAddons %}
                    <div> 
                        {% for addon in item.addons %}
                            {% if addon.addonTitle %}
                                {{ addon.addonTitle }} - Adults x {{addon.adultQuantity}} , Child x {{addon.childQuantity}}<br>
                            {% else %}
                                {{ addon.label|raw }} - {{ 'currency.symbol'|trans() ~ addon.rackPrice  }}<br />
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
                {% if item.anyExtras %}
                    <div> 
                        {% for extra in item.extras %}
                            {% if extra.addonTitle %}
                                {{ extra.addonTitle }} x {{extra.quantity}} <br>
                            {% else %}
                                {{ extra.label|raw }} - {{ 'currency.symbol'|trans() ~ extra.rackPrice }}<br />
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
    <div class="right-panel" style="border:1px solid;border-radius: 4px;padding: 20px;display: inline-block;">
        <div>
            <strong style="text-decoration:underline">Price details:</strong> <br> <br> 
        </div>
        <div>
            <strong>Service Type: </strong>
            <span style="text-transform:capitalize">
            {% if item.product is not null %}
                {{ item.product.transportationType.name }}
            {% elseif item.type == constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::TYPE_ACTIVITY_REGULAR') %}
                {{ item.activity.name }}
                <br>
                <small class="small_activity_text">
                    (Activity Type: {{item.activityType}})
                    {% if item.activityType == "Group" %}
                        (Adults: {{item.adultCount}}   x {{ item.activity.groupAdultRackPrice }}  = ${{item.adultCount * item.activity.groupAdultRackPrice}} )
                        (Children: {{item.childCount}} x {{ item.activity.groupKidRackPrice }}  = ${{item.childCount * item.activity.groupKidRackPrice}} )
                    {% else %}
                        (Adults: {{item.adultCount}}   x {{ item.activity.adultRackPrice }}  = ${{item.adultCount * item.activity.adultRackPrice}} )
                        (Children: {{item.childCount}} x {{ item.activity.childRackPrice }}  = ${{item.childCount * item.activity.childRackPrice}} )
                    {% endif %}
                    {% if item.pickAddFeeRack is not null and item.pickAddFeeRack != 0.00 %}
                      (Pick-up Additional Fee: ${{ item.pickAddFeeRack }})
                    {% endif %}
                    {% if item.dropAddFeeRack is not null and item.dropAddFeeRack != 0.00 %}
                      (Drop-off Additional Fee: ${{ item.dropAddFeeRack }})
                    {% endif %}
                </small>
            {% elseif item.type == constant('\\App\\Wicrew\\SaleBundle\\Entity\\OrderItem::TYPE_ACTIVITY_TRANSPORTATION') %}
                {{ item.activity.name ~ 'order.items.activity.transportation'|trans }}
            {% endif %}
            </span>  
        </div>
        <div>
            {% set totalPassengers = item.adultCount + item.childCount %} 
            <strong>Adults: </strong> {{ item.adultCount }}<br> 
            {% if item.childCount > 0 %}
                <strong>Children: </strong> {{ item.childCount }}<br> 
            {% endif %}

            {% set november1st = '2023-11-01' %}
            {% if item.product and item.pickDate|date('Y-m-d') >= november1st and item.product.novemberFixedRackPrice != 0 %}
                {% if item.product is not null and item.product.transportationType.isPrivateType() %}
                    <strong>{{ 'order.details.basicprice'|trans() }}: </strong>{{ 'currency.symbol'|trans() ~ item.product.novemberFixedRackPrice }}<br> 
                {% elseif item.product is not null and item.product.transportationType == 'Jeep-Boat-Jeep shared' %}
                    <strong>{{ 'order.details.basicprice'|trans() }}: </strong>{{ 'currency.symbol'|trans() ~ (( item.adultCount * item.product.novemberAdultRackPrice ) + ( item.childCount * item.product.childRackPrice ))|number_format(2, '.', ',') }}<br> 
                {% endif %}            
            {% else %}
          
                {% if item.product is not null and item.product.transportationType.isPrivateType() %}
                    <strong>{{ 'order.details.basicprice'|trans() }}: </strong>{{ 'currency.symbol'|trans() ~ item.product.fixedRackPrice }}<br> 
                {% elseif item.product is not null and item.product.transportationType == 'Jeep-Boat-Jeep shared' %}
                    <strong>{{ 'order.details.basicprice'|trans() }}: </strong>{{ 'currency.symbol'|trans() ~ (( item.adultCount * item.product.adultRackPrice ) + ( item.childCount * item.product.childRackPrice ))|number_format(2, '.', ',') }}<br> 
                {% endif %}
            {% endif %}

            
        </div>
        {% if item.anyTimeRangeFees %}
            <div>
                {% if item.regularTimeFeeRack is not null %}
                    <div>
                        <label>{{ 'product.section.regular_time_range'|trans }}</label> {{ 'currency.symbol'|trans() ~ item.regularTimeFeeRack }}
                    </div>
                {% endif %}
                {% if item.flightPickTimeFeeRack is not null %}
                    <div>
                        <label>{{ 'product.section.flight_pickup_time_range'|trans }}</label> {{ 'currency.symbol'|trans() ~ item.flightPickTimeFeeRack }}
                    </div>
                {% endif %}
                {% if item.flightDropTimeFeeRack is not null %}
                    <div>
                        <label>{{ 'product.section.flight_drop_off_time_range'|trans }}</label> {{ 'currency.symbol'|trans() ~ item.flightDropTimeFeeRack }}
                    </div>
                {% endif %}
            </div> 
        {% endif %} 

        {% if item.customServices is not null %}
            <br /><br />
            <div>
                {% for customService in item.customServices %} 
                    <strong>Custom Service: </strong>{{customService.label}}<br />
                    <strong>Price : </strong>{{ 'currency.symbol'|trans() ~ customService.rackPrice }}<br><br>  
                {% endfor %} 
            </div>
        {% endif %}
        
        {% set currencySymbol = 'currency.symbol'|trans() %}
        {% set currencyText = 'currency.text'|trans() %}
        {% if item.anyAddons %}<br> 
            <div> 
                {% for addon in item.addons %} 
                    {% if addon.addonTitle %}
                        <strong>Service type: </strong>Add-on<br>
                        <strong>Item : </strong>{{ addon.label|raw }}<br>   
                        <strong>Rack price : </strong>{{ addon.rackPrice ~ 'currency.symbol'|trans()}}<br><br>  
                    {% else %}
                        {{ addon.label|raw }} - {{ 'currency.symbol'|trans() ~ addon.rackPrice }}<br> 
                    {% endif %}
                {% endfor %} 
            </div>
        {% endif %}
        {% if item.anyExtras %} 
            <div> 
                {% for extra in item.extras %}
                    {% if extra.addonTitle %}
                            <strong>Service type: </strong>Add-on<br>
                            <strong>Item : </strong>{{ extra.label|raw }}<br>   
                            <strong>Rack price : </strong>{{ extra.rackPrice ~ 'currency.symbol'|trans()}}<br><br> 
                    {% else %}
                        {{ extra.label|raw }} - {{ 'currency.symbol'|trans() ~ extra.rackPrice }}
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}<br>  
        <div>
            <label>TOTAL:</label> {{ 'currency.symbol'|trans() ~ item.subtotalRack }}
        </div>
        <div>
            <label>Tax:</label> {{ 'currency.symbol'|trans() ~ (item.grandTotal - item.subtotalRack) }}
        </div>
        <div>
            <label>TOTAL with tax:</label> {{ 'currency.symbol'|trans() ~ item.grandTotal }}
        </div>
    </div>
</div> 